$(document).ready(function(){var canvas=$("#canvas")[0];var ctx=canvas.getContext("2d");var canvas_width=$("#canvas").width();var canvas_height=$("#canvas").height();var cell_width=10;var snake_direction;var food;var score;var snake_array;function init(){snake_direction="right";init_snake(5);create_food();score=0;if(typeof game!="undefined")clearInterval(game);game=setInterval(game_loop,60)}init();function init_snake(len){if(len<5)len=5;snake_array=[];for(var i=len-1;i>=0;i--){snake_array.push({x:i,y:0})}}function create_food(){food={x:Math.round(Math.random()*(canvas_width-cell_width)/cell_width),y:Math.round(Math.random()*(canvas_height-cell_width)/cell_width),}}function game_loop(){draw_background();update_snake(snake_array[0].x,snake_array[0].y);draw_snake();draw_cell(food.x,food.y);ctx.fillText("Score: "+score,5,canvas_height-5)}function update_snake(head_x,head_y){if(snake_direction=="right")head_x++;else if(snake_direction=="left")head_x--;else if(snake_direction=="up")head_y--;else if(snake_direction=="down")head_y++;if(head_x==-1||head_x==canvas_width/cell_width||head_y==-1||head_y==canvas_width/cell_width||check_collision(head_x,head_y,snake_array)){init();return}if(head_x==food.x&&head_y==food.y){var tail={x:head_x,y:head_y};score++;create_food()}else{var tail=snake_array.pop();tail.x=head_x;tail.y=head_y}snake_array.unshift(tail)}function draw_background(){ctx.fillStyle="white";ctx.fillRect(0,0,canvas_width,canvas_width);ctx.strokeStyle="black";ctx.strokeRect(0,0,canvas_width,canvas_width)}function draw_snake(){for(var i=0;i<snake_array.length;i++){draw_cell(snake_array[i].x,snake_array[i].y)}}function draw_cell(x,y){ctx.fillStyle="blue";ctx.fillRect(x*cell_width,y*cell_width,cell_width,cell_width);ctx.strokeStyle="white";ctx.strokeRect(x*cell_width,y*cell_width,cell_width,cell_width)}function check_collision(x,y,array){for(var i=0;i<array.length;i++){if(array[i].x==x&&array[i].y==y)return true}return false}$(document).keydown(function(e){var key=e.which;if(key=="37"&&snake_direction!="right")snake_direction="left";else if(key=="38"&&snake_direction!="down")snake_direction="up";else if(key=="39"&&snake_direction!="left")snake_direction="right";else if(key=="40"&&snake_direction!="up")snake_direction="down"})})